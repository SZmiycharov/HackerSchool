<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8' />
    <title>JSONCreator</title>
    <link rel='stylesheet' style='text/css' href='deps/opt/bootstrap.css' />
  </head>
  <body>
    
    
    <ul class="nav nav-tabs" id="svz-main-tabs">
        <li><a data-target="#svz-schema-form-1" data-toggle="tab">Schema1</a></li>
        <button type="button" class="btn btn-primary" id="add-new-schema-form">
          <span class="glyphicon glyphicon-plus"></span>
        </button>
    </ul>
    
    <div class="tab-content">
  
<!-- Schema form and preview 1 -->
      <div id="svz-schema-form-1" class="tab-pane active">
          <div  style='float:left; width:45%; margin-left: 50px; margin-top: 20px;'> 
            <ul class="nav nav-tabs" id="svz-schema-form-tabs">
              <li class="active"><a data-target="#svz-schema-tab" data-toggle="tab">Schema</a></li>
              <li><a data-target="#svz-form-tab" data-toggle="tab">Form</a></li>
            </ul>
            <div class="tab-content">
              <div class="tab-pane active" id="svz-schema-tab">
                <h2>For schema:</h2>
                <form id='svz-schema-form' action='javascript:void(0);' onsubmit='GenerateTextForm();'>
                    <div><select id='svz-selected-type' name='type' required multiple>
                        <option label='object' value='object'>object</option>
                        <option label='array' value='array'>array</option>
                        <option label='number' value='number'>number</option> 
                        <option label='integer' value='integer'>integer</option>
                        <option label='string' value='string'>string</option>  
                        <option label='boolean' value='boolean'>boolean</option> 
                        <option label='null' value='null'>null</option>
                    </select></div>
                    <div><input id="svz-key" placeholder='Key (Unique identifier)' type='text' name='key' required></div>
                    <div><input placeholder='Title' type='text' name='title'></div>
                    <div><input placeholder='Ordering' type='number' name='ordering'></div>
                    <div><input class='longtext' id='svz-description' placeholder='Description' type='text' name='description'></div>
                    <div><label><input id='svz-required' type='checkbox' name='required'>Required (check for true)</label></div>
                    <input class="btn btn-primary" id='svz-schema-form-submit' type='submit'>
                </form>
              </div>
              <div class="tab-pane" id="svz-form-tab">
                <h2 id='svz-for-form'>For form:</h2>
                <form id='svz-for-form-form'></form>
              </div>
            </div> 
          </div>
          <div  id='svz-json-preview' style='float:right; width:45%; margin-right: 30px; margin-top: 20px;'>
            <h3>Preview appears here:</h3>
            <p id='svz-json-text-header'>When you choose options json will appear here! :)</p>
            <pre id='svz-json-text'></pre>
          </div>
    </div>
<!-- Schema form and preview 1 and here!!! -->

<!-- Schema form and preview 2 -->
      <div id="svz-schema-form-2" class="tab-pane">
          <div  style='float:left; width:45%; margin-left: 50px; margin-top: 20px;'> 
            <ul class="nav nav-tabs" id="svz-schema-form-tabs-2">
              <li class="active"><a data-target="#svz-schema-tab" data-toggle="tab">Schema</a></li>
              <li><a data-target="#svz-form-tab" data-toggle="tab">Form</a></li>
            </ul>
            <div class="tab-content">
              <div class="tab-pane active" id="svz-schema-tab-2">
                <h2>For schema:</h2>
                <form id='svz-schema-form-2' action='javascript:void(0);' onsubmit='GenerateTextForm();'>
                    <div><select id='svz-selected-type-2' name='type' required multiple>
                        <option label='object' value='object'>object</option>
                        <option label='array' value='array'>array</option>
                        <option label='number' value='number'>number</option> 
                        <option label='integer' value='integer'>integer</option>
                        <option label='string' value='string'>string</option>  
                        <option label='boolean' value='boolean'>boolean</option> 
                        <option label='null' value='null'>null</option>
                    </select></div>
                    <div><input id="svz-key-2" placeholder='Key (Unique identifier)' type='text' name='key' required></div>
                    <div><input placeholder='Title' type='text' name='title'></div>
                    <div><input class='longtext' id='svz-description-2' placeholder='Description' type='text' name='description'></div>
                    <div><label><input id='svz-required-2' type='checkbox' name='required'>Required (check for true)</label></div>
                    <input class="btn btn-primary" id='svz-schema-form-submit-2' type='submit'>
                </form>
              </div>
              <div class="tab-pane" id="svz-form-tab-2">
                <h2 id='svz-for-form-2'>For form:</h2>
                <form id='svz-for-form-form-2'></form>
              </div>
            </div> 
          </div>
          <div  id='svz-json-preview' style='float:right; width:45%; margin-right: 30px; margin-top: 20px;'>
            <h3>Preview appears here:</h3>
            <p id='svz-json-text-header'>When you choose options json will appear here! :)</p>
            <pre id='svz-json-text'></pre>
          </div>
    </div>
<!-- Schema form and preview 2 and here!!! -->

<!-- Schema form and preview 3 -->
      <div id="svz-schema-form-3" class="tab-pane">
          <div  style='float:left; width:45%; margin-left: 50px; margin-top: 20px;'> 
            <ul class="nav nav-tabs" id="svz-schema-form-tabs-3">
              <li class="active"><a data-target="#svz-schema-tab" data-toggle="tab">Schema</a></li>
              <li><a data-target="#svz-form-tab" data-toggle="tab">Form</a></li>
            </ul>
            <div class="tab-content">
              <div class="tab-pane active" id="svz-schema-tab-3">
                <h2>For schema:</h2>
                <form id='svz-schema-form-3' action='javascript:void(0);' onsubmit='GenerateTextForm();'>
                    <div><select id='svz-selected-type-3' name='type' required multiple>
                        <option label='object' value='object'>object</option>
                        <option label='array' value='array'>array</option>
                        <option label='number' value='number'>number</option> 
                        <option label='integer' value='integer'>integer</option>
                        <option label='string' value='string'>string</option>  
                        <option label='boolean' value='boolean'>boolean</option> 
                        <option label='null' value='null'>null</option>
                    </select></div>
                    <div><input id="svz-key-3" placeholder='Key (Unique identifier)' type='text' name='key' required></div>
                    <div><input placeholder='Title' type='text' name='title'></div>
                    <div><input class='longtext' id='svz-description-3' placeholder='Description' type='text' name='description'></div>
                    <div><label><input id='svz-required-3' type='checkbox' name='required'>Required (check for true)</label></div>
                    <input class="btn btn-primary" id='svz-schema-form-submit-3' type='submit'>
                </form>
              </div>
              <div class="tab-pane" id="svz-form-tab">
                <h2 id='svz-for-form'>For form:</h2>
                <form id='svz-for-form-form'></form>
              </div>
            </div> 
          </div>
          <div  id='svz-json-preview' style='float:right; width:45%; margin-right: 30px; margin-top: 20px;'>
            <h3>Preview appears here:</h3>
            <p id='svz-json-text-header'>When you choose options json will appear here! :)</p>
            <pre id='svz-json-text'></pre>
          </div>
      </div>
    </div>
<!-- Schema form and preview 3 and here!!! -->

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script type='text/javascript' src='deps/bootstrap.min.js'></script>
    <script type='text/javascript' src='deps/bootstrap-multiselect.js'></script>
    <link rel="stylesheet" href="deps/bootstrap-multiselect.css" type="text/css"/>
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script type='text/javascript' src='deps/underscore.js'></script>
    <script type='text/javascript' src='deps/opt/jsv.js'></script>
    <script type='text/javascript' src='lib/jsonform.js'></script>
    <script src="http://benalman.com/code/projects/jquery-throttle-debounce/jquery.ba-throttle-debounce.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/2.4.1/lodash.min.js"></script>
    <script type='text/javascript' src='deps/jquery-ui.min.js'></script>
    <script type='text/javascript'>

(function svzMainFunction ($) {
  'use strict';
    $( document ).ready(function() {
      $("#svz-main-tabs").tabs();
      var TIMEOUT_DEBOUNCE = 500;
      var CURRENT_SCHEMA_FORM_ID = 1;

      $('#svz-selected-type').multiselect({
          buttonWidth: '220px',
          nonSelectedText: 'Choose type',
          numberDisplayed: 3
      });


      $('#add-new-schema-form').click(function(){
        CURRENT_SCHEMA_FORM_ID += 1;
        $('<li><a data-target="#svz-schema-form-' + CURRENT_SCHEMA_FORM_ID + '" data-toggle="tab">Schema' + CURRENT_SCHEMA_FORM_ID + '</a></li>').insertBefore('#add-new-schema-form');

        newSchemaForm = "<div id='svz-schema-form-1' class='tab-pane active'> <div style='float:left; width:45%; margin-left: 50px; margin-top: 20px;'> <ul class='nav nav-tabs' id='svz-schema-form-tabs'> <li class='active'><a data-target='#svz-schema-tab' data-toggle='tab'>Schema</a></li> <li><a data-target='#svz-form-tab' data-toggle='tab'>Form</a></li> </ul> <div class='tab-content'> <div class='tab-pane active' id='svz-schema-tab'> <h2>For schema:</h2> <form id='svz-schema-form' action='javascript:void(0);' onsubmit='GenerateTextForm();'> <div><select id='svz-selected-type' name='type' required multiple> <option label='object' value='object'>object</option> <option label='array' value='array'>array</option> <option label='number' value='number'>number</option> <option label='integer' value='integer'>integer</option> <option label='string' value='string'>string</option> <option label='boolean' value='boolean'>boolean</option> <option label='null' value='null'>null</option> </select></div> <div><input id='svz-key' placeholder='Key (Unique identifier)' type='text' name='key' required></div> <div><input placeholder='Title' type='text' name='title'></div> <div><input placeholder='Ordering' type='number' name='ordering'></div> <div><input class='longtext' id='svz-description' placeholder='Description' type='text' name='description'></div> <div><label><input id='svz-required' type='checkbox' name='required'>Required (check for true)</label></div> <input class='btn btn-primary' id='svz-schema-form-submit' type='submit'> </form> </div> <div class='tab-pane' id='svz-form-tab'> <h2 id='svz-for-form'>For form:</h2> <form id='svz-for-form-form'></form> </div> </div> </div> <div id='svz-json-preview' style='float:right; width:45%; margin-right: 30px; margin-top: 20px;'> <h3>Preview appears here:</h3> <p id='svz-json-text-header'>When you choose options json will appear here! :)</p> <pre id='svz-json-text'></pre> </div> </div>"




        $('#svz-main-tabs a:last').tab('show');

      });

 
      var required = [];
      var properties = {};




      $('#svz-selected-type').change($.debounce(TIMEOUT_DEBOUNCE, function() {
          var selectedType = $(this).val();
          $('.additionaloption').remove();

          if (selectedType){
            if (_.include(selectedType, 'number') || _.include(selectedType, 'integer') && _.include(selectedType, 'string')) {
            $('#svz-schema-form-submit').remove();
            $('#svz-schema-form').append('<div class="additionaloption" class="form-group"><input id="svz-max-length" type="number" name="maxLength" placeholder="Maximum length"></div>');
            $('#svz-schema-form').append('<div class="additionaloption" class="form-group"><input id="svz-min-length" type="number" name="minLength" placeholder="Minimum length"></div>');
            $('#svz-schema-form').append('<div class="additionaloption" class="form-group"><input id="svz-min-items" type="number" name="minItems" placeholder="Minimum items"></div>');
            $('#svz-schema-form').append('<div class="additionaloption" class="form-group"><input id="svz-max-items" type="number" name="maxItems" placeholder="Maximum items"></div>');
            $('#svz-schema-form').append('<div class="additionaloption" class="form-group"><input id="minimum" type="number" name="minimum" placeholder="Minimum"></div>');
            $('#svz-schema-form').append('<div hidden class="additionaloption" class="form-group"  id="exclusive-min-div"><label><input id="exclusiveMinimum" name="exclusiveMinimum" type="checkbox" placeholder="Exclusive minimum">Check - num will be more than minimum</label></div>');
            $('#svz-schema-form').append('<div class="additionaloption" class="form-group"><input id="maximum" type="number" name="maximum" placeholder="Maximum"></div>');
            $('#svz-schema-form').append('<div hidden class="additionaloption" class="form-group" id="exclusive-max-div"><label><input id="exclusiveMaximum" name="exclusiveMaximum" type="checkbox" placeholder="Exclusive maximum">Check - num will be less than minimum</label></div>');
            $('#svz-schema-form').append('<div class="additionaloption" class="form-group"><input name="default" id="svz-default" type="number" placeholder="Default"></div>');
            $('#svz-schema-form').append('<div class="additionaloption"><label><input id="svz-readonly" name="readonly" type="checkbox">Readonly (check for true)</label></div>');
            $('#svz-schema-form').append('<input class="btn btn-primary" id="svz-schema-form-submit" type="submit">');
            } else if (_.include(selectedType, 'string')){
              $('#svz-schema-form-submit').remove();
              $('#svz-schema-form').append('<div class="additionaloption" class="form-group"><input id="svz-max-length" type="number" name="maxLength" placeholder="Maximum length"></div>');
              $('#svz-schema-form').append('<div class="additionaloption" class="form-group"><input id="svz-min-length" type="number" name="minLength" placeholder="Minimum length"></div>'); 
              $('#svz-schema-form').append('<div class="additionaloption" class="form-group"><input id="svz-min-items" type="number" name="minItems" placeholder="Minimum items"></div>');
              $('#svz-schema-form').append('<div class="additionaloption" class="form-group"><input id="svz-max-items" type="number" name="maxItems" placeholder="Maximum items"></div>');
              $('#svz-schema-form').append('<div class="additionaloption" class="form-group"><input name="default" id="svz-default" type="text" placeholder="Default"></div>');
              $('#svz-schema-form').append('<div class="additionaloption"><label><input id="svz-readonly" name="readonly" type="checkbox">Readonly (check for true)</label></div>');
              $('#svz-schema-form').append('<input class="btn btn-primary" id="svz-schema-form-submit" type="submit">');
            } else if (_.include(selectedType, 'number') || _.include(selectedType, 'integer')){
              $('#svz-schema-form-submit').remove();
              $('#svz-schema-form').append('<div class="additionaloption" class="form-group"><input id="svz-max-length" type="number" name="maxLength" placeholder="Maximum length"></div>');
              $('#svz-schema-form').append('<div class="additionaloption" class="form-group"><input id="svz-min-length" type="number" name="minLength" placeholder="Minimum length"></div>');
              $('#svz-schema-form').append('<div class="additionaloption" class="form-group"><input id="minimum" type="number" name="minimum" placeholder="Minimum"></div>');
              $('#svz-schema-form').append('<div hidden class="additionaloption" class="form-group"  id="exclusive-min-div"><label><input id="exclusiveMinimum" name="exclusiveMinimum" type="checkbox" placeholder="Exclusive minimum">Check - num will be more than minimum</label></div>');
              $('#svz-schema-form').append('<div class="additionaloption" class="form-group"><input id="maximum" type="number" name="maximum" placeholder="Maximum"></div>');
              $('#svz-schema-form').append('<div hidden class="additionaloption" class="form-group" id="exclusive-max-div"><label><input id="exclusiveMaximum" name="exclusiveMaximum" type="checkbox" placeholder="Exclusive maximum">Check - num will be less than minimum</label></div>');
              $('#svz-schema-form').append('<div class="additionaloption" class="form-group"><input name="default" id="svz-default" type="number" placeholder="Default"></div>');
              $('#svz-schema-form').append('<div class="additionaloption"><label><input id="svz-readonly" name="readonly" type="checkbox">Readonly (check for true)</label></div>');
              $('#svz-schema-form').append('<input class="btn btn-primary" id="svz-schema-form-submit" type="submit">');
            }
          }
      }));
    
      $(document).on('change','#minimum',function(){
        $('#exclusive-min-div').toggle(!!$(this).val());
      }); 
      $(document).on('change','#maximum',function(){
        $('#exclusive-max-div').toggle(!!$(this).val());
      }); 


      window.GenerateTextForm = function(){
        var typeFromSelect = $('#svz-selected-type').val();
        var typesFromSelectArray = [];

        if (typeFromSelect){

          $('#svz-for-form-form').empty();

          var schemaFormDataArray = $('#svz-schema-form').serializeArray();
          var currentProperties = {};
          var toDeleteRequired = true;

          jQuery.each( schemaFormDataArray, function( i, field ) {
            if (field.name == 'title' && field.value != '') {
              currentProperties['title'] = field.value;
            } else if (field.name == 'description' && field.value != '') {
              currentProperties['description'] = field.value;
            } else if (field.name == 'type' && field.value != '') {
              typesFromSelectArray.push(field.value);
              currentProperties['type'] = typesFromSelectArray;
            } else if (field.name == 'key' && field.value != '') {
              currentProperties['key'] = field.value;
            } else if (field.name == 'required') {
              toDeleteRequired = false;
              if (field.value && !(_.include(required, currentProperties['key']))) {
                  required.push(currentProperties['key']);
              }
            } else if (field.name == 'default' && field.value != ''){
              currentProperties['default'] = field.value;
            } else if (field.name == 'maxLength' && field.value != ''){
              currentProperties['maxLength'] = field.value;
            } else if (field.name == 'minLength' && field.value != ''){
              currentProperties['minLength'] = field.value;
            } else if (field.name == 'minimum' && field.value != ''){
              currentProperties['minimum'] = field.value;
            } else if (field.name == 'maximum' && field.value != ''){
              currentProperties['maximum'] = field.value;
            } else if (field.name == 'exclusiveMaximum' && field.value != ''){
              currentProperties['exclusiveMaximum' && field.value != ''] = true;
            } else if (field.name == 'exclusiveMinimum' && field.value != ''){
              currentProperties['exclusiveMinimum' && field.value != ''] = true;
            } else if (field.name == 'minItems' && field.value != ''){
              currentProperties['minItems'] = field.value;
            } else if (field.name == 'maxItems' && field.value != ''){
              currentProperties['maxItems'] = field.value;
            } else if (field.name == 'readonly' && field.value != ''){
              currentProperties['readonly'] = true;
            } else if (field.name == 'ordering' && field.value != ''){
              currentProperties['ordering'] = field.value;
            }
          });

          // _.grep(arr, function(item) {
          //   return item.value !== '';
          // });

          if (toDeleteRequired){
            required.splice(_.indexOf(required, currentProperties['key'], 1));
          }

          properties[currentProperties['key']] = currentProperties;

          if(typeFromSelect == 'object'){
            console.log('will do this later!');
          } else if(typeFromSelect == 'array'){
            var jsonPreview = {};
          } else{
            var jsonPreview = {
              'schema': {
                'type': 'object',
                'properties': properties
              }
            };

            if (required != ''){
              jsonPreview['required'] = required;
            } else{
              delete jsonPreview['required'];
            }
          }
          $('#svz-json-text-header').hide();
          $('#svz-json-text').html(JSON.stringify(jsonPreview, undefined, 2));

          $('#svz-for-form-form').jsonForm({
            schema: {
              title: {
                type: 'string',
                title: 'Title'
              },
              description: {
                type: 'string',
                title: 'Description'
              },
              type: {
                type: 'string',
                title: 'Type'
              }
            },
            onSubmit: function (errors, values) {
              if (errors) {
                console.log(errors);
                $('#res').html('<p>Fix your mistakes!</p>');
              } else {
                console.log("print form, will do it later!");
              }
            }
          }); 

        } else{
            $('#svz-for-form-form').hide();
            $('#svz-minimize-schema-button').click();
        }
      } 
    });
    
  })(jQuery);

      
    </script>
  </body>
</html>