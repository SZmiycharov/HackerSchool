<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8' />
    <title>Generated form</title>
    <link rel='stylesheet' style='text/css' href='deps/opt/bootstrap.css' />
  </head>
  <body>
          <div class="form-group"  style='float:left; width:45%; margin-left: 30px; margin-top: 20px;'>
                <div class='widget-content' class="form-group">
                  <h2>For schema:</h2>
                  <form id='svz-for-schema-form' action='javascript:void(0);' onsubmit='GenerateTextForm();'>
                      <div><select id='svz-selected-type' name='type' required multiple>
                          <option selected='selected' value=''>Choose type</option>
                          <option label='object' value='object'>object</option>
                          <option label='array' value='array'>array</option>
                          <option label='number' value='number'>number</option> 
                          <option label='integer' value='integer'>integer</option>
                          <option label='string' value='string'>string</option>  
                          <option label='boolean' value='boolean'>boolean</option> 
                          <option label='null' value='null'>null</option>
                      </select></div>
                      <div><input placeholder='Title' type='text' name='title'></div>
                      <div><input placeholder='Key (Unique identifier)' type='text' name='key' required></div>
                      <div><input class='longtext' id='svz-description' placeholder='Description' type='text' name='description'></div>
                      <div><label><input id='svz-required' type='checkbox' name='required'>Required (check for true)</label></div>
                      <input type='submit'>
                  </form>
                </div>

                <button id='svz-minimize-schema-button' class='btn-minimize' style='display: none;'>â‡•</button>
                <h2 id='svz-for-form' hidden>For form:</h2>

                <form id='svz-for-form-form'></form>
              </div>
                  

                
            <div class="form-group"  id='svz-json-preview' style='float:right; width:45%; margin-right: 30px; margin-top: 20px;'>
              <h3>Preview appears here:</h3>
              <p id='svz-json-text-header'>When you choose options json will appear here! :)</p>
              <pre id='svz-json-text'></pre>
            </div>

    <script type='text/javascript' src='deps/jquery.min.js'></script>
    <script type='text/javascript' src='deps/underscore.js'></script>
    <script type='text/javascript' src='deps/opt/jsv.js'></script>
    <script type='text/javascript' src='lib/jsonform.js'></script>
    <script type='text/javascript'>
(function function_name ($) {
  'use strict';
    $( document ).ready(function() {

      var required = [];
      var properties = {};    

      $('.btn-minimize').click(function(){
        $(this).toggleClass('btn-plus');
        $('.widget-content').slideToggle();
      });

      $('#svz-selected-type').click(function() {
        var duration = 500;
        var thistype = $(this).val();

        setTimeout(function() {
          $('.additionaloption').remove();

          if (thistype == 'string'){
            $('#svz-selected-type').after('<div><input id="svz-max-length" type="number" placeholder="svz-max-length"></div>');
            $('#svz-selected-type').after('<div><label><input id="svz-read-only" type="checkbox">Readonly (check for true)</label></div>');
          }

          else if (thistype == 'number' || thistype == 'integer'){
            $('#svz-description').after('<div class="additionaloption" class="form-group"><input id="svz-max-length" type="number" placeholder="svz-max-length"></div>');
            $('#svz-description').after('<div class="additionaloption" class="form-group"><input id="minLength" type="number" placeholder="minLength"></div>');
            $('#svz-description').after('<div class="additionaloption" class="form-group"><input id="minItems" type="number" placeholder="minItems"></div>');
            $('#svz-description').after('<div class="additionaloption" class="form-group"><input id="maxItems" type="number" placeholder="maxItems"></div>');
            $('#svz-description').after('<div class="additionaloption" class="form-group"><input id="minimum" type="number" placeholder="minimum"></div>');
            $('#svz-description').after('<div class="additionaloption" class="form-group"><label><input id="exclusiveMinimum" type="checkbox" placeholder="exclusiveMinimum">Check - num will be more than minimum</label></div>');
            $('#svz-description').after('<div class="additionaloption" class="form-group"><input id="maximum" type="number" placeholder="maximum"></div>');
            $('#svz-description').after('<div class="additionaloption" class="form-group"><label><input id="exclusiveMaximum" type="checkbox" placeholder="exclusiveMaximum">Check - num will be less than minimum</label></div>');
            $('#svz-description').after('<div class="additionaloption" class="form-group"><input id="svz-read-only" type="number" placeholder="Read only"></div>');
            $('#svz-description').after('<div class="additionaloption" class="form-group"><input id="default" type="number" placeholder="default"></div>');
          }

          else if(thistype == 'boolean'){
            console.log('it is boolean maafak');
          }
        }, duration);
          
      });

      
      window.GenerateTextForm = function(){
        var $typeInput = $('#svz-selected-type');
        var type = $typeInput.val();
        var typesArray = [];

        if (type){
          $('#svz-minimize-schema-button').click();
          $('#svz-minimize-schema-button').show();
          $('#svz-for-form').show();

          $('#svz-for-form-form').empty();

          var forschemaformdata = $('#svz-for-schema-form').serialize().replace(/\+/g,' ');
          var testforschemaform = $('#svz-for-schema-form').serializeArray();
          var currentProperties = {};
          var toDeleteRequired = true;

          jQuery.each( testforschemaform, function( i, field ) {
            if (field.name == 'title' && field.value != ''){
              currentProperties['title'] = field.value;
            } else if (field.name == 'description' && field.value != ''){
              currentProperties['description'] = field.value;
            } else if (field.name == 'type' && field.value != ''){
              typesArray.push(field.value);
              currentProperties['type'] = typesArray;
            } else if (field.name == 'key' && field.value != ''){
              currentProperties['key'] = field.value;
            } else if (field.name == 'required'){
              toDeleteRequired = false;
                if (field.value && required.indexOf(currentProperties['key']) == -1){
                    required.push(currentProperties['key']);
                }
            }
          });
          if (toDeleteRequired){
            required.splice(required.indexOf(currentProperties['key']), 1);
          }

          properties[currentProperties['key']] = currentProperties;

          $('#svz-for-form-form').jsonForm({
            schema: {
              title: {
                type: 'string',
                title: 'Title'
              },
              description: {
                type: 'string',
                title: 'Description'
              },
              type: {
                type: 'string',
                title: 'Type'
              }

            },
            onSubmit: function (errors, values) {
              if (errors) {
                console.log(errors);
                $('#res').html('<p>Fix your mistakes!</p>');
              } else {
                  if(type == 'object'){

                  } else if(type == 'array'){
                    var jsonPreview = {};
                    } else{
                      var jsonPreview = {
                        'schema': {
                          'type': 'object',
                          'properties': properties
                        }
                      }
                      if (required != ''){
                        jsonPreview['required'] = required;
                      }
                      else{
                        delete jsonPreview['required'];
                      }
                    }
                $('#svz-json-text-header').hide();

                $('#svz-json-text').html(JSON.stringify(jsonPreview, undefined, 2));
              }
            }
          });
        } else{
            $('#svz-for-form-form').hide();
            $('#svz-minimize-schema-button').click();
        }
      } 
    });
    
  })(jQuery);

      
    </script>
  </body>
</html>