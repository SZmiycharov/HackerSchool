<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Generated form</title>
    <link rel="stylesheet" style="text/css" href="deps/opt/bootstrap.css" />
  </head>
  <body>
          <div style="float:left; width:45%;">
                <div class="widget-content">
                <form id="form1" action="javascript:void(0);" onsubmit="GenerateTextForm();">
                    <input placeholder="Title" type="text" name="title"><br><br>

                    <select id="type" name="type" required>
                        <option selected="selected" value="">Choose type</option>
                        <option label="text" value="text">text</option>
                        <option label="textarea" value="textarea">textarea</option>
                        <option label="number" value="number">number</option>
                        <option label="email" value="email">email</option>
                        <option label="password" value="password">password</option>
                        <option label="dropdown" value="dropdown">dropdown</option>
                        <option label="radios" value="radios">radios</option>
                        <option label="radios-inline" value="radios-inline">radios-inline</option>
                        <option label="radiobuttons" value="radiobuttons">radiobuttons</option>
                        <option label="checkbox" value="checkbox">checkbox</option>
                        <option label="checkboxes" value="checkboxes">checkboxes</option>
                        <option label="boolean" value="boolean">boolean</option>
                        <option label="date" value="date">date</option>
                        <option label="time" value="time">time</option>
                        <option label="date-time" value="date-time">date-time</option>
                        <option label="button" value="button">button</option>
                        <option label="submit" value="submit">submit</option>
                        <option label="reset" value="reset">reset</option>
                        <option label="help" value="help">help</option>
                        <option label="template" value="template">template</option>
                    </select><br><br>

                    <input placeholder="Key (Unique identifier)" type="text" name="key"><br><br>

                    <input class="longtext" id="description" placeholder="Description" type="text" name="description"><br><br>

                    <label><input type="checkbox" name="hidetitle">Don't show title</label><br><br>
                    <label><input id="showadvancedoptions" type="checkbox" name="showadvancedoptions" onclick="showAdvancedOptions();">Show advanced options</label><br><br>
                    
                    
                    <!-- When showadvancedoptions is checked show below content -->

                    <div id="advancedoptions" hidden="True">
                        <label><input type="checkbox" name="disablesuccess">Disable success state</label><br><br>
                        <label><input type="checkbox" name="disableerror">Disable error state</label><br><br>
                        <label><input type="checkbox" name="readonly">Readonly</label><br><br>

                        <input class="longtext" id="validationmessage" placeholder="Validation message" type="text" name="validationmessage"><br><br>
                        <h5>A custom validation error message. It can be a string, an object with error codes as key and<br> messages as values or a custom message function</h5>

                        <input class="longtext" id="onchange" placeholder="onChange" type="text" name="onchange"><br><br>
                        <h5>onChange event handler, expression or function. For expression, modelValue and form are <br>both available. For a function, they will be passed as parameters in that order</h5>

                        <input class="shorttext" id="feedbackicon" placeholder="Feedback Icon" type="text" name="feedbackicon"><br><br>
                        <h5>Inline feedback icons. To turn off just set feedback to false. If set to a string that string<br> is evaluated by a ngClass in the decorators scope. If not set att all the default value<br> is { "glyphicon": true, "glyphicon-ok": hasSuccess(), "glyphicon-remove": hasError() }</h5>

                        <input class="shorttext" id="placeholder" placeholder="Placeholder" type="text" name="placeholder"><br><br>
                        <h5>Placeholder on inputs and textarea</h5>

                        <input class="longtext" id="ngmodeloptions" placeholder="ng-Model Options" type="text" name="ngmodeloptions"><br><br>
                        <h5>Passed along to ng-model-options</h5>

                        <input class="shorttext" id="classoffield" placeholder="Class" type="text" name="classoffield"><br><br>
                        <h5>CSS Class(es) to be added to the container div e.g. : 'street foobar'</h5>

                        <input class="shorttext" id="destroystrategy" placeholder="Destroy strategy" type="text" name="destroystrategy"><br><br>
                        <h5>One of <code>null</code>, <code>empty</code> , <code>remove</code>, or <code>retain</code>. <br>Changes model on $destroy event. default is <code>remove</code></h5>

                        <input class="shorttext" id="copyvalueto" placeholder="Copy Value To" type="text" name="copyvalueto"><br><br>
                        <h5>Copy values to these schema keys e.g ['address.street']. The receiving fields can be shown, <br>but the intent for them is to be hidden.</h5>

                        <input class="shorttext" id="fieldclass" placeholder="Field Class" type="text" name="fieldclass"><br><br>
                        <h5>CSS Class(es) to be added to field input (or similar)</h5>

                        <input class="shorttext" id="labelclass" placeholder="Label Class" type="text" name="labelclass"><br><br>
                        <h5>CSS Class(es) to be added to the label of the field (or similar)</h5>

                        <input class="shorttext" id="condition" placeholder="Condition" type="text" name="condition"><br><br>
                        <h5>Show or hide field depending on an angular expression e.g 'model.age &lt; 18'. <br>The expression has access to <code>model</code>, <code>modelValue</code>, <code> arrayIndex</code>.  The condition need not<br> reference a model value it could be anything on scope.</h5>

                        <input class="shorttext" id="fieldaddonleft" placeholder="Field Addon - Left" type="text" name="fieldaddonleft"><br><br>
                        <h5>Add html code to left of input field. For reference check <a target="_blank" href="http://getbootstrap.com/components/#input-groups">bootstrap input groups</a></h5>

                        <input class="shorttext" id="fieldaddonright" placeholder="Field Addon - Right" type="text" name="fieldaddonright"><br><br>
                        <h5>Add html code to right of input field. For reference check <a target="_blank" href="http://getbootstrap.com/components/#input-groups">bootstrap input groups</a></h5>
                    </div>


                  <input type="submit">
                </form>

                </div>
                <button id="changeform1button" class="btn-minimize" style="display: none;">â‡•</button>
                <form id="form2"></form>
              </div>
                  

                
            <div id="jsonpreview" style="float:right; width:45%;">
              <h3>Preview appears here:</h3>
              <p id="p1">When you choose options json will appear here! :)</p>
            </div>

    <script type="text/javascript" src="deps/jquery.min.js"></script>
    <script type="text/javascript" src="deps/underscore.js"></script>
    <script type="text/javascript" src="deps/opt/jsv.js"></script>
    <script type="text/javascript" src="lib/jsonform.js"></script>
    <script type="text/javascript">


      function getParameterByName(name, url) {
        if (!url) url = window.location.href;
        name = name.replace(/[\[\]]/g, "\\$&");
        var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
            results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return '';
        return decodeURIComponent(results[2].replace(/\+/g, " "));
      }    


      $(".btn-minimize").click(function(){
        $(this).toggleClass('btn-plus');
        $(".widget-content").slideToggle();
      });


      function showAdvancedOptions(){
              if(document.getElementById('showadvancedoptions').checked) {
                  $("#advancedoptions").show();
              } else {
                  $("#advancedoptions").hide();
              }
      };

      
    function GenerateTextForm(){
        console.log('in GenerateTextForm; making form now');

        var e = document.getElementById("type");
        var type = e.value;

        if (type){
          document.getElementById("changeform1button").click();
          $("#changeform1button").show();

          var form2 = document.getElementById("form2");
          while (form2.firstChild) {
              form2.removeChild(form2.firstChild);
          }

          form1data = $('#form1').serialize().replace(/\+/g,' ');;
          console.log(form1data);
          title = form1data.split('title=')[1].split('&')[0];
          descr = form1data.split('description=')[1].split('&')[0];
          type = form1data.split('type=')[1].split('&')[0];


          $('#form2').jsonForm({
            schema: {
              title: {
                type: 'string',
                title: 'Title'
              },
              description: {
                type: 'string',
                title: 'Description'
              },
              type: {
                type: 'string',
                title: 'Type',
                required: true
              }

            },
            onSubmit: function (errors, values) {
              console.log(title);
              if (errors) {
                $('#res').html('<p>I beg your pardon?</p>');
              }
              else {
                jsonpreview = JSON.stringify({
                  "schema": {
                    "name": {
                      "title": title,
                      "description": descr,
                      "type": type
                    }
                  }
                }, null, 4)

                document.getElementById("jsonpreview").appendChild(document.createElement('pre')).innerHTML = jsonpreview;
              }
            }
          });
        }
        else{
          $('#form2').hide();
        }
      }

    </script>
  </body>
</html>